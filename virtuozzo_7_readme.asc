Virtuozzo 7 Technical Preview - Virtual Machines Readme
=======================================================
:doctype: book

Virtuozzo Overview
------------------

Virtuozzo is a CentOS-based server virtualization solution that enables you to simultaneously run multiple virtual machines and containers on a single physical server. With it, you can efficiently use your server hardware resources by distributing them among virtual machines and containers.

The key changes in Virtuozzo 7 are as follows:

* Virtuozzo 7 is based on CentOS 7 and Kernel 3.10+.
* Virtuozzo 7 uses the KVM/QEMU hypervisor.
* Containers use cgroups and namespaces that limit, account for, and isolate resource usage as isolated namespaces of a collection of processes. The beancounters interface remains in place for backward compatibility. At the same time, it acts as a proxy for actual cgroups and namespaces implementation.
* UUIDs are used to identify both virtual machines and containers. With containers, `prlctl` treats the former VEID parameter as name.
* VCMM 4th generation of memory manager. Virtuozzo 7 uses memcg. Balancing and configuring memcg limits enables getting the exact overcommit, shadow gangs, swap, page cache overuse Virtuozzo parameters. These operations are handled by a userspace daemon.
* Virtuozzo provides guest tools for virtual machines that currently allow executing commands in VMs from the host, set user passwords, and set and obtain network settings.

What's New in This Technical Preview
------------------------------------

This technical preview introduces virtual machines. Virtuozzo 7 uses the KVM/QEMU hypervisor and manages virtual machines via the libvirt API. Virtual machine HDD images are stored in the QCOW2 format. This release also ships with Virtuozzo guest tools for Linux and Windows that currently allow you to execute commands in VMs from the host, set VM user passwords, and set and obtain VM network settings.

Supported Guest Operating Systems
---------------------------------

The following guest operating systems are supported in this technical preview of Virtuozzo:

*Virtual Machines*

.Windows
[options="compact"]
* Windows Server 2012 R2
* Windows Server 2012
* Windows Server 2008 R2 with Service Pack 1
* Windows 8 (x64, x86)
* Windows 7 (x64, x86)

.Linux
[options="compact"]
* CentOS 7.x (x64)
* CentOS 6.x (x64)
* Debian 8.x (x64)
* Ubuntu 14.04 LTS (x64)

*Containers*

[options="compact"]
* CentOS 7.x (x64)
* CentOS 6.x (x64)
* Debian 8.x (x64)
* Ubuntu 14.04 LTS (x64)

Installing Virtuozzo 7 Technical Preview
----------------------------------------

Virtuozzo 7 installer is based on the CentOS 7 installer. You can install Virtuozzo directly on bare hardware or in a virtual machine. The following configurations are recommended:

[options="compact"]
* 4 vCPU
* 8GB RAM
* 100GB Disk

Installing Virtuozzo 7 Technical Preview on Bare Metal
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To install the technical preview on a hardware node, burn the distribution ISO image on a USB stick, boot your hardware node from it, and follow wizard's instructions.

Installing Virtuozzo 7 Technical Preview in Virtual Machines
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To install the technical preview in a virtual machine, for example, one created with Virtuozzo 6, do the following:

. Login to the hardware node running Virtuozzo 6 and create a CentOS 7 virtual machine. For example:
+
[subs="quotes"]
----
*# prlctl create vz7vm -d centos7*
----
. Mount the distribution ISO image:
+
[subs="quotes"]
----
*# prlctl set vz7vm --device-set cdrom0 --image _&lt;path_to_virtuozzo7_ISO&gt;_*
----
. Check the virtual CD-ROM status and connect the CD if needed:
+
[subs="quotes"]
----
*# prlctl set vz7vm --device-set cdrom0 --connect*
----
. Assign an IP address using DHCP:
+
[subs="quotes"]
----
*# prlctl set vz7vm --ifname net0 --dhcp yes --network Bridged*
----
+
or manually:
+
[subs="quotes"]
----
*# prlctl set vz7vm --ifname eth0 --ipadd _&lt;IP&gt;_ --nameserver _&lt;DNS_server&gt;_*
----
. Start the virtual machine:
+
[subs="quotes"]
----
*# prlctl start vz7vm*
----
. Set VNC mapping to the host and use it for installation:
+
[subs="quotes"]
----
*# prlctl set vz7vm --vnc-mode manual --vnc-port 5901 --vnc-passwd _&lt;passwd&gt;_*
----
. Boot from the virtual CD-ROM and follow wizard's instructions to install the Virtuozzo 7 Technical Preview.

After installation has finished, login to the Virtuozzo 7 node or virtual machine and verify installation as follows.

. Check the version of Virtuozzo:
+
[subs="quotes"]
----
*# prlsrvctl info*
----
. List all installed packages: 
+
[subs="quotes"]
----
*# yum list*
----
. Update your Virtuozzo installation to make sure you've got the latest version:
+
[subs="quotes"]
----
*# yum update*
----

Your Virtuozzo 7 installation is ready. For information on how you can create and manage containers, see the _Virtuozzo 7 User's Guide_ bundled with the distribution.

Known Issues and Restrictions
-----------------------------

* Autopartitioning for standard partitions in the Virtuozzo 7 installer does not work. For details, see https://bugzilla.redhat.com/show_bug.cgi?id=1172441[RHEL bug #1172441] (#PSBM-34787)
* Container console does not work in Openstack.
* simfs does not work.
* VM migration is not supported. (#PSBM-40084)
* In-place VM disks resize is not supported. (#PSBM-40778, #PSBM-42127)
* CPU limits for VMs work differently compared to Parallels Cloud Server 6.0. Certain features like limits in MHz are not implemented. (#PSBM-40823)
* Configuring guest settings (e.g., network, password) of stopped VMs may not work. (#PSBM-41445)
* Configuring network settings of a running VM may not work. (#PSBM-42131)
* The command `prlctl enter` and the option `--chandsid` are not implemented in guest tools. (#PSBM-40821)
* Autoballoning is not supported for virtual machines. (#PSBM-35096)
* EFI virtual machines are not supported. (PSBM-40704, #PSBM-42171)
* Reverting to an offline snapshot after making modifications to its hardware does not dispose of said modifications. For details, see https://bugzilla.redhat.com/show_bug.cgi?id=1081148. (#PSBM-42031)
* In Windows VMs, each new SCSI HDD may be added as offline. As a workaround, you can either bring each disk back online manually. Alternatively, before the first boot with a new disk, run `san policy=onlineall` in DISKPART to set the SAN policy to `OnlineAll`. (#PSBM-41663)


Dropped Functionality
---------------------

* VZFS
* Delayed `/vz` mounting
